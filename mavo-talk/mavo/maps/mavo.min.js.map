{"version":3,"sources":["expressions.js"],"names":["_defineProperty","obj","key","value","Object","defineProperty","enumerable","configurable","writable","_toConsumableArray","arr","Array","isArray","i","arr2","length","from","_typeof","Symbol","iterator","constructor","$","$$","_","Mavo","Expressions","Class","mavo","_this","this","expressions","syntax","Expression","Syntax","create","element","closest","traverse","undefined","scheduled","Set","treeBuilt","then","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","next","done","et","item","Node","get","selectors","multiple","group","push","mavoNode","Primitive","attribute","primitive","store","modes","err","addEventListener","evt","action","node","closestCollection","has","property","setTimeout","update","PROPERTYCHANGE_THROTTLE","add","requestAnimationFrame","root","rootGroup","_this2","Element","data","getData","relative","null","unhandled","walk","path","isDeleted","env","context","apply","concat","hooks","run","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","changedBy","extract","name","directives","indexOf","test","textContent","ExpressionText","slice","split","map","_this3","arguments","nodeType","normalize","ESCAPE","is","attributes","forEach","childNodes","child","static","directive","o","plugin","self","Proxy","_this4","options","collection","_env$data","toPrimitive","proxy","index","id","Group","ret","walkUp","children","find","filter","set","Error","_this5","template","Bliss","expressiontext-init-start","getValueAttribute","fallback","getValue","expression","getAttribute","parsed","start","end"],"mappings":"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","file":"mavo.min.js","sourcesContent":["(function($, $$) {\n\nvar _ = Mavo.Expressions = $.Class({\n\tconstructor: function(mavo) {\n\t\tthis.mavo = mavo;\n\n\t\tthis.expressions = [];\n\n\t\tvar syntax = Mavo.Expression.Syntax.create(this.mavo.element.closest(\"[mv-expressions]\")) || Mavo.Expression.Syntax.default;\n\t\tthis.traverse(this.mavo.element, undefined, syntax);\n\n\t\tthis.scheduled = new Set();\n\n\t\t// Watch changes and update value\n\t\tthis.mavo.treeBuilt.then(() => {\n\t\t\tfor (let et of this.expressions) {\n\t\t\t\tet.item = Mavo.Node.get(et.element.closest(Mavo.selectors.multiple + \", \" + Mavo.selectors.group));\n\t\t\t\tet.item.expressions = et.item.expressions || [];\n\t\t\t\tet.item.expressions.push(et);\n\n\t\t\t\tvar mavoNode = Mavo.Node.get(et.element, true);\n\n\t\t\t\tif (mavoNode && mavoNode instanceof Mavo.Primitive && mavoNode.attribute == et.attribute) {\n\t\t\t\t\tet.primitive = mavoNode;\n\t\t\t\t\tmavoNode.store = mavoNode.store || \"none\";\n\t\t\t\t\tmavoNode.modes = \"read\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.mavo.element.addEventListener(\"mavo:datachange\", evt => {\n\t\t\t\tif (evt.action == \"propertychange\" && evt.node.closestCollection) {\n\t\t\t\t\t// Throttle propertychange events in collections\n\t\t\t\t\tif (!this.scheduled.has(evt.property)) {\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\tthis.scheduled.delete(evt.property);\n\t\t\t\t\t\t\tthis.update(evt);\n\t\t\t\t\t\t}, _.PROPERTYCHANGE_THROTTLE);\n\n\t\t\t\t\t\tthis.scheduled.add(evt.property);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\trequestAnimationFrame(() => this.update(evt));\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.update();\n\t\t});\n\t},\n\n\tupdate: function callee(evt) {\n\t\tvar root, rootGroup;\n\n\t\tif (evt instanceof Element) {\n\t\t\troot = evt.closest(Mavo.selectors.group);\n\t\t\tevt = null;\n\t\t}\n\n\t\troot = root || this.mavo.element;\n\t\trootGroup = Mavo.Node.get(root);\n\n\t\tvar data = rootGroup.getData({\n\t\t\trelative: true,\n\t\t\tstore: \"*\",\n\t\t\tnull: true,\n\t\t\tunhandled: this.mavo.unhandled\n\t\t});\n\n\t\trootGroup.walk((obj, path) => {\n\t\t\tif (obj.expressions && obj.expressions.length && !obj.isDeleted()) {\n\t\t\t\tlet env = { context: this, data: $.value(data, ...path) };\n\n\t\t\t\tMavo.hooks.run(\"expressions-update-start\", env);\n\n\t\t\t\tfor (let et of obj.expressions) {\n\t\t\t\t\tif (et.changedBy(evt)) {\n\t\t\t\t\t\tet.update(env.data, evt);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\textract: function(node, attribute, path, syntax) {\n\t\tif (attribute && attribute.name == \"mv-expressions\") {\n\t\t\treturn;\n\t\t}\n\n\t\tif ((attribute && _.directives.indexOf(attribute.name) > -1) ||\n\t\t    syntax.test(attribute? attribute.value : node.textContent)\n\t\t) {\n\t\t\tthis.expressions.push(new Mavo.ExpressionText({\n\t\t\t\tnode, syntax,\n\t\t\t\tpath: path? path.slice(1).split(\"/\").map(i => +i) : [],\n\t\t\t\tattribute: attribute && attribute.name,\n\t\t\t\tmavo: this.mavo\n\t\t\t}));\n\t\t}\n\t},\n\n\t// Traverse an element, including attribute nodes, text nodes and all descendants\n\ttraverse: function(node, path = \"\", syntax) {\n\t\tif (node.nodeType === 8) {\n\t\t\t// We don't want expressions to be picked up from comments!\n\t\t\t// Commenting stuff out is a common debugging technique\n\t\t\treturn;\n\t\t}\n\n\t\tif (node.nodeType === 3) { // Text node\n\t\t\t// Leaf node, extract references from content\n\t\t\tthis.extract(node, null, path, syntax);\n\t\t}\n\t\telse {\n\t\t\tnode.normalize();\n\n\t\t\tsyntax = Mavo.Expression.Syntax.create(node) || syntax;\n\n\t\t\tif (syntax === Mavo.Expression.Syntax.ESCAPE) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (Mavo.is(\"multiple\", node)) {\n\t\t\t\tpath = \"\";\n\t\t\t}\n\n\t\t\t$$(node.attributes).forEach(attribute => this.extract(node, attribute, path, syntax));\n\t\t\t$$(node.childNodes).forEach((child, i) => this.traverse(child, `${path}/${i}`, syntax));\n\t\t}\n\t},\n\n\tstatic: {\n\t\tdirectives: [],\n\n\t\tPROPERTYCHANGE_THROTTLE: 50,\n\n\t\tdirective: function(name, o) {\n\t\t\t_.directives.push(name);\n\t\t\tMavo.attributes.push(name);\n\n\t\t\tMavo.plugin(o);\n\t\t}\n\t}\n});\n\nif (self.Proxy) {\n\tMavo.hooks.add(\"node-getdata-end\", function(env) {\n\t\tif (env.options.relative && (env.data && typeof env.data === \"object\" || this.collection)) {\n\t\t\tvar data = env.data;\n\n\t\t\tif (this instanceof Mavo.Primitive) {\n\t\t\t\tenv.data = {\n\t\t\t\t\t[Symbol.toPrimitive]: () => data,\n\t\t\t\t\t[this.property]: data\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tenv.data = new Proxy(env.data, {\n\t\t\t\tget: (data, property, proxy) => {\n\t\t\t\t\t// Checking if property is in proxy might add it to the data\n\t\t\t\t\tif (property in data || (property in proxy && property in data)) {\n\t\t\t\t\t\treturn data[property];\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\thas: (data, property) => {\n\t\t\t\t\tif (property in data) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Property does not exist, look for it elsewhere\n\n\t\t\t\t\tif (property == \"$index\") {\n\t\t\t\t\t\treturn data[property] = (this.index || 0) + 1;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (property == \"$all\") {\n\t\t\t\t\t\treturn data[property] = this.closestCollection? this.closestCollection.getData(env.options) : [env.data];\n\t\t\t\t\t}\n\n\t\t\t\t\tif (property == \"$next\" || property == \"$previous\") {\n\t\t\t\t\t\tif (this.closestCollection) {\n\t\t\t\t\t\t\treturn data[property] = this.closestCollection.getData(env.options)[this.index + (property == \"$next\"? 1 : -1)];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn data[property] = null;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (property == this.mavo.id) {\n\t\t\t\t\t\treturn data[property] = this.mavo.root.getData(env.options);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this instanceof Mavo.Group && property == this.property && this.collection) {\n\t\t\t\t\t\treturn data[property] = env.data;\n\t\t\t\t\t}\n\n\t\t\t\t\t// First look in ancestors\n\t\t\t\t\tvar ret = this.walkUp(group => {\n\t\t\t\t\t\tif (property in group.children) {\n\t\t\t\t\t\t\treturn group.children[property];\n\t\t\t\t\t\t};\n\t\t\t\t\t});\n\n\t\t\t\t\tif (ret === undefined) {\n\t\t\t\t\t\t// Still not found, look in descendants\n\t\t\t\t\t\tret = this.find(property);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (ret !== undefined) {\n\t\t\t\t\t\tif (Array.isArray(ret)) {\n\t\t\t\t\t\t\tret = ret.map(item => item.getData(env.options))\n\t\t\t\t\t\t\t\t\t .filter(item => item !== null);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (ret instanceof Mavo.Node) {\n\t\t\t\t\t\t\tret = ret.getData(env.options);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdata[property] = ret;\n\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\n\t\t\t\tset: function(data, property, value) {\n\t\t\t\t\tthrow Error(\"You canâ€™t set data via expressions.\");\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n}\n\nMavo.hooks.add(\"init-tree-before\", function() {\n\tthis.expressions = new Mavo.Expressions(this);\n});\n\n// Must be at a hook that collections don't have a marker yet which messes up paths\nMavo.hooks.add(\"node-init-end\", function() {\n\tvar template = this.template;\n\n\tif (template && template.expressions) {\n\t\t// We know which expressions we have, don't traverse again\n\t\tthis.expressions = template.expressions.map(et => new Mavo.ExpressionText({\n\t\t\ttemplate: et,\n\t\t\titem: this,\n\t\t\tmavo: this.mavo\n\t\t}));\n\t}\n});\n\n// TODO what about granular rendering?\nMavo.hooks.add(\"render-end\", function() {\n\tthis.expressions.update();\n});\n\nMavo.hooks.add(\"collection-add-end\", function(env) {\n\tthis.mavo.expressions.update(env.item.element);\n});\n\n})(Bliss, Bliss.$);\n\n// mv-value plugin\nMavo.Expressions.directive(\"mv-value\", {\n\thooks: {\n\t\t\"expressiontext-init-start\": function() {\n\t\t\tif (this.attribute == \"mv-value\") {\n\t\t\t\tthis.attribute = Mavo.Primitive.getValueAttribute(this.element);\n\t\t\t\tthis.fallback = this.fallback || Mavo.Primitive.getValue(this.element, {attribute: this.attribute});\n\t\t\t\tthis.expression = this.element.getAttribute(\"mv-value\");\n\n\t\t\t\tthis.parsed = [new Mavo.Expression(this.expression)];\n\t\t\t\tthis.expression = this.syntax.start + this.expression + this.syntax.end;\n\t\t\t}\n\t\t}\n\t}\n});\n"],"sourceRoot":"/source/"}